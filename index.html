<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>サッカーPKゲーム</title>
  <style>
    body { text-align: center; font-family: Arial, sans-serif; background-color: #0c3; color: #fff; }
    #gameArea { position: relative; width: 600px; height: 400px; margin: 20px auto; background-color: #090; border: 2px solid #fff; overflow: hidden; }
    #ball { position: absolute; width: 30px; height: 30px; background-color: white; border-radius: 50%; bottom: 20px; left: calc(50% - 15px); }
    #goalkeeper { position: absolute; width: 80px; height: 80px; background-color: #f00; border-radius: 50%; top: 50px; left: calc(50% - 40px); transition: left 0.5s; }
    #powerBar { width: 300px; height: 20px; background-color: #ddd; margin: 10px auto; position: relative; }
    #power { width: 0%; height: 100%; background-color: #f00; }
    #message { font-size: 24px; margin-top: 20px; }
    button { padding: 10px 20px; font-size: 16px; margin-top: 10px; }
  </style>
</head>
<body>
  <h1>サッカーPKゲーム</h1>
  <div id="gameArea">
    <div id="ball"></div>
    <div id="goalkeeper"></div>
  </div>
  <div id="powerBar">
    <div id="power"></div>
  </div>
  <button id="shootButton">シュート！</button>
  <p id="message"></p>

  <script>
    const ball = document.getElementById('ball');
    const goalkeeper = document.getElementById('goalkeeper');
    const powerBar = document.getElementById('power');
    const shootButton = document.getElementById('shootButton');
    const message = document.getElementById('message');
    let power = 0;
    let increasing = true;
    let powerInterval;
    let gameInProgress = false;

    function startPowerBar() {
      power = 0;
      increasing = true;
      powerBar.style.width = '0%';
      powerInterval = setInterval(() => {
        if (increasing) {
          power += 1;
          if (power >= 100) {
            increasing = false;
          }
        } else {
          power -= 1;
          if (power <= 0) {
            increasing = true;
          }
        }
        powerBar.style.width = power + '%';
      }, 10);
    }

    function stopPowerBar() {
      clearInterval(powerInterval);
    }

    function shootBall() {
      if (gameInProgress) return;
      gameInProgress = true;
      stopPowerBar();
      message.textContent = '';
      const shootDirection = prompt('シュート方向を選んでください（左、中央、右）:');
      if (!['左', '中央', '右'].includes(shootDirection)) {
        message.textContent = '無効な方向です。もう一度やり直してください。';
        gameInProgress = false;
        startPowerBar();
        return;
      }
      // ゴールキーパーの動きをランダムに決定
      const goalkeeperDirections = ['左', '中央', '右'];
      const goalkeeperChoice = goalkeeperDirections[Math.floor(Math.random() * 3)];

      // ゴールキーパーのアニメーション
      let goalkeeperMove = 0;
      if (goalkeeperChoice === '左') {
        goalkeeperMove = -100;
      } else if (goalkeeperChoice === '右') {
        goalkeeperMove = 100;
      }
      goalkeeper.style.left = `calc(50% - 40px + ${goalkeeperMove}px)`;

      // ボールのアニメーション
      let ballMoveX = 0;
      if (shootDirection === '左') {
        ballMoveX = -100;
      } else if (shootDirection === '右') {
        ballMoveX = 100;
      }
      ball.style.transition = 'bottom 0.5s, left 0.5s';
      ball.style.bottom = '350px';
      ball.style.left = `calc(50% - 15px + ${ballMoveX}px)`;

      // 結果の判定
      setTimeout(() => {
        if (shootDirection !== goalkeeperChoice || power > 70) {
          message.textContent = 'ゴール！';
        } else {
          message.textContent = 'セーブされました！';
        }
        resetPositions();
        gameInProgress = false;
        startPowerBar();
      }, 800);
    }

    function resetPositions() {
      // ゴールキーパーを元の位置に戻す
      goalkeeper.style.left = 'calc(50% - 40px)';
      // ボールを元の位置に戻す
      ball.style.transition = 'none';
      ball.style.bottom = '20px';
      ball.style.left = 'calc(50% - 15px)';
      setTimeout(() => {
        ball.style.transition = 'bottom 0.5s, left 0.5s';
      }, 50);
    }

    shootButton.addEventListener('click', shootBall);

    startPowerBar();
  </script>
</body>
</html>
