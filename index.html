<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>ババ抜きゲーム</title>
  <style>
    body { text-align: center; font-family: Arial, sans-serif; }
    h1 { margin-top: 20px; }
    #gameArea { display: flex; justify-content: center; flex-wrap: wrap; margin: 20px; }
    .card {
      width: 60px;
      height: 90px;
      border: 1px solid #000;
      border-radius: 5px;
      margin: 3px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 18px;
      cursor: pointer;
      background-color: #fff;
    }
    .hidden {
      background-color: #eee;
      cursor: pointer;
    }
    .matched {
      background-color: #ccc;
      cursor: default;
    }
    #playerHand, #computerHand {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      margin: 10px;
    }
    #message { font-size: 18px; margin: 10px; }
    #startButton {
      padding: 10px 20px;
      font-size: 18px;
      margin-top: 10px;
    }
  </style>
</head>
<body>
  <h1>ババ抜きゲーム</h1>
  <div id="gameArea">
    <div>
      <h2>あなたの手札</h2>
      <div id="playerHand"></div>
    </div>
    <div>
      <h2>コンピュータの手札</h2>
      <div id="computerHand"></div>
    </div>
  </div>
  <div id="message"></div>
  <button id="startButton">ゲーム開始</button>
  <script>
    const suits = ['♠', '♥', '♦', '♣'];
    let deck = [];
    let playerHand = [];
    let computerHand = [];
    let gameOver = false;

    const playerHandDiv = document.getElementById('playerHand');
    const computerHandDiv = document.getElementById('computerHand');
    const messageDiv = document.getElementById('message');
    const startButton = document.getElementById('startButton');

    startButton.addEventListener('click', startGame);

    function startGame() {
      startButton.disabled = true;
      gameOver = false;
      messageDiv.textContent = '';
      initDeck();
      dealCards();
      removePairs(playerHand);
      removePairs(computerHand);
      renderHands();
      if (playerHand.length === 0) {
        gameOver = true;
        messageDiv.textContent = 'あなたの勝ちです！';
        startButton.disabled = false;
      } else if (computerHand.length === 0) {
        gameOver = true;
        messageDiv.textContent = 'コンピュータの勝ちです！';
        startButton.disabled = false;
      } else {
        messageDiv.textContent = 'あなたの番です。コンピュータの手札から1枚選んでください。';
      }
    }

    function initDeck() {
      deck = [];
      for (let suit of suits) {
        for (let i = 1; i <= 13; i++) {
          deck.push({ suit, number: i });
        }
      }
      // ジョーカーを追加
      deck.push({ suit: 'Joker', number: 0 });
      shuffle(deck);
    }

    function shuffle(array) {
      for (let i = array.length -1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i+1));
        [array[i], array[j]] = [array[j], array[i]];
      }
    }

    function dealCards() {
      playerHand = [];
      computerHand = [];
      deck.forEach((card, index) => {
        if (index % 2 === 0) {
          playerHand.push(card);
        } else {
          computerHand.push(card);
        }
      });
    }

    function removePairs(hand) {
      hand.sort((a, b) => a.number - b.number);
      for (let i = 0; i < hand.length -1; ) {
        if (hand[i].number === hand[i+1].number && hand[i].suit !== 'Joker') {
          hand.splice(i, 2);
        } else {
          i++;
        }
      }
    }

    function renderHands() {
      // プレイヤーの手札
      playerHandDiv.innerHTML = '';
      playerHand.forEach((card, index) => {
        const cardDiv = document.createElement('div');
        cardDiv.classList.add('card');
        cardDiv.textContent = card.suit === 'Joker' ? 'Joker' : card.suit + card.number;
        playerHandDiv.appendChild(cardDiv);
      });

      // コンピュータの手札
      computerHandDiv.innerHTML = '';
      computerHand.forEach((card, index) => {
        const cardDiv = document.createElement('div');
        cardDiv.classList.add('card', 'hidden');
        cardDiv.textContent = '🂠';
        cardDiv.addEventListener('click', () => {
          if (!gameOver) {
            playerTurn(index);
          }
        });
        computerHandDiv.appendChild(cardDiv);
      });
    }

    function playerTurn(index) {
      const card = computerHand.splice(index, 1)[0];
      playerHand.push(card);
      removePairs(playerHand);
      renderHands();
      checkGameOver();
      if (!gameOver) {
        setTimeout(computerTurn, 1000);
      }
    }

    function computerTurn() {
      const index = Math.floor(Math.random() * playerHand.length);
      const card = playerHand.splice(index, 1)[0];
      computerHand.push(card);
      removePairs(computerHand);
      renderHands();
      checkGameOver();
      if (!gameOver) {
        messageDiv.textContent = 'あなたの番です。コンピュータの手札から1枚選んでください。';
      }
    }

    function checkGameOver() {
      if (playerHand.length === 0) {
        gameOver = true;
        messageDiv.textContent = 'あなたの勝ちです！';
        startButton.disabled = false;
      } else if (computerHand.length === 0) {
        gameOver = true;
        messageDiv.textContent = 'コンピュータの勝ちです！';
        startButton.disabled = false;
      }
    }
  </script>
</body>
</html>
