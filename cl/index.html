<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>シンプルプラットフォーマー</title>
    <style>
        canvas {
            border: 1px solid black;
            display: block;
            margin: 0 auto;
        }
    </style>
</head>
<body>
    <canvas id="gameCanvas" width="800" height="400"></canvas>
    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');

        // ゲーム状態
        const gameState = {
            player: {
                x: 50,
                y: 200,
                width: 30,
                height: 30,
                speed: 5,
                jumpForce: 10,
                velocityY: 0,
                isJumping: false
            },
            platforms: [
                {x: 0, y: 350, width: 800, height: 50},
                {x: 300, y: 250, width: 200, height: 20},
                {x: 600, y: 150, width: 150, height: 20}
            ],
            gravity: 0.5,
            keys: {}
        };

        // キー入力の処理
        document.addEventListener('keydown', (e) => {
            gameState.keys[e.code] = true;
        });

        document.addEventListener('keyup', (e) => {
            gameState.keys[e.code] = false;
        });

        // プレイヤーの更新
        function updatePlayer() {
            // 左右移動
            if (gameState.keys['ArrowLeft']) {
                gameState.player.x -= gameState.player.speed;
            }
            if (gameState.keys['ArrowRight']) {
                gameState.player.x += gameState.player.speed;
            }

            // ジャンプ
            if (gameState.keys['Space'] && !gameState.player.isJumping) {
                gameState.player.velocityY = -gameState.player.jumpForce;
                gameState.player.isJumping = true;
            }

            // 重力の適用
            gameState.player.velocityY += gameState.gravity;
            gameState.player.y += gameState.player.velocityY;

            // プラットフォームとの衝突検出
            gameState.platforms.forEach(platform => {
                if (
                    gameState.player.x < platform.x + platform.width &&
                    gameState.player.x + gameState.player.width > platform.x &&
                    gameState.player.y + gameState.player.height > platform.y &&
                    gameState.player.y < platform.y + platform.height
                ) {
                    // 上からの衝突
                    if (gameState.player.velocityY > 0) {
                        gameState.player.isJumping = false;
                        gameState.player.velocityY = 0;
                        gameState.player.y = platform.y - gameState.player.height;
                    }
                }
            });

            // 画面外に出ないように制限
            gameState.player.x = Math.max(0, Math.min(canvas.width - gameState.player.width, gameState.player.x));
            gameState.player.y = Math.min(canvas.height - gameState.player.height, gameState.player.y);
        }

        // 描画関数
        function draw() {
            // 背景のクリア
            ctx.fillStyle = 'skyblue';
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            // プレイヤーの描画
            ctx.fillStyle = 'red';
            ctx.fillRect(gameState.player.x, gameState.player.y, gameState.player.width, gameState.player.height);

            // プラットフォームの描画
            ctx.fillStyle = 'green';
            gameState.platforms.forEach(platform => {
                ctx.fillRect(platform.x, platform.y, platform.width, platform.height);
            });
        }

        // ゲームループ
        function gameLoop() {
            updatePlayer();
            draw();
            requestAnimationFrame(gameLoop);
        }

        // ゲーム開始
        gameLoop();
    </script>
</body>
</html>
