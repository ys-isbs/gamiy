<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>シンプルプラットフォーマー</title>
    <style>
        body {
            margin: 0;
            overflow: hidden;
            background-color: #87CEEB; /* 空の色 */
        }
        canvas {
            display: block;
            margin: 0 auto;
            background-color: #87CEEB;
        }
    </style>
</head>
<body>
<canvas id="gameCanvas" width="800" height="450"></canvas>
<script>
    const canvas = document.getElementById('gameCanvas');
    const ctx = canvas.getContext('2d');

    const gravity = 0.5;
    const friction = 0.8;

    let keys = {};

    // プレイヤークラス
    class Player {
        constructor() {
            this.width = 50;
            this.height = 50;
            this.x = 100;
            this.y = canvas.height - this.height - 100;
            this.velX = 0;
            this.velY = 0;
            this.speed = 5;
            this.jumpStrength = 15;
            this.onGround = false;
            this.color = '#FF0000';
        }

        update() {
            // 横移動
            if (keys['ArrowRight'] || keys['KeyD']) {
                if (this.velX < this.speed) {
                    this.velX++;
                }
            }

            if (keys['ArrowLeft'] || keys['KeyA']) {
                if (this.velX > -this.speed) {
                    this.velX--;
                }
            }

            // ジャンプ
            if ((keys['ArrowUp'] || keys['KeyW'] || keys['Space']) && this.onGround) {
                this.velY = -this.jumpStrength;
                this.onGround = false;
            }

            // 重力適用
            this.velY += gravity;

            // 速度に摩擦を適用
            this.velX *= friction;

            // 位置更新
            this.x += this.velX;
            this.y += this.velY;

            // 地面との衝突判定
            if (this.y + this.height >= canvas.height - 50) {
                this.y = canvas.height - 50 - this.height;
                this.velY = 0;
                this.onGround = true;
            }

            // 壁との衝突判定
            if (this.x < 0) {
                this.x = 0;
                this.velX = 0;
            }

            if (this.x + this.width > canvas.width) {
                this.x = canvas.width - this.width;
                this.velX = 0;
            }
        }

        draw() {
            ctx.fillStyle = this.color;
            ctx.fillRect(this.x, this.y, this.width, this.height);
        }
    }

    // プラットフォームクラス
    class Platform {
        constructor(x, y, width, height) {
            this.x = x;
            this.y = y;
            this.width = width;
            this.height = height;
            this.color = '#654321';
        }

        draw() {
            ctx.fillStyle = this.color;
            ctx.fillRect(this.x, this.y, this.width, this.height);
        }
    }

    // ゲームオブジェクトの初期化
    const player = new Player();
    const platforms = [
        new Platform(0, canvas.height - 50, canvas.width, 50),
        new Platform(200, canvas.height - 150, 200, 20),
        new Platform(500, canvas.height - 250, 200, 20),
        new Platform(300, canvas.height - 350, 200, 20)
    ];

    // キー入力の監視
    window.addEventListener('keydown', function(e) {
        keys[e.code] = true;
    });

    window.addEventListener('keyup', function(e) {
        keys[e.code] = false;
    });

    // 衝突判定関数
    function checkCollision(player, platform) {
        if (player.x < platform.x + platform.width &&
            player.x + player.width > platform.x &&
            player.y < platform.y + platform.height &&
            player.y + player.height > platform.y) {
            
            // プレイヤーの下側がプラットフォームの上側に接触している場合
            if (player.velY > 0 && player.y + player.height - player.velY <= platform.y) {
                player.y = platform.y - player.height;
                player.velY = 0;
                player.onGround = true;
            }
        }
    }

    // メインループ
    function gameLoop() {
        // 画面をクリア
        ctx.clearRect(0, 0, canvas.width, canvas.height);

        // プラットフォームを描画
        platforms.forEach(platform => platform.draw());

        // プレイヤーを更新・描画
        player.update();

        // 衝突判定
        player.onGround = false;
        platforms.forEach(platform => checkCollision(player, platform));

        player.draw();

        requestAnimationFrame(gameLoop);
    }

    // ゲーム開始
    gameLoop();
</script>
</body>
</html>
